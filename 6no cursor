CREATE TABLE O_Roll_Call (
    Roll_no int PRIMARY KEY,
    Name VARCHAR(30),
    Address VARCHAR(30)
);

CREATE TABLE N_Roll_Call (
    Roll_no NUMBER,
    Name VARCHAR(30),
    Address VARCHAR(30)
);
INSERT INTO O_Roll_Call VALUES (1, 'Bhakti', 'Pune');
INSERT INTO O_Roll_Call VALUES (2, 'Swaraj', 'Mumbai');

INSERT INTO N_Roll_Call VALUES (2, 'Swaraj', 'Mumbai');
INSERT INTO N_Roll_Call VALUES (3, 'Aarav', 'Nashik');
INSERT INTO N_Roll_Call VALUES (4, 'Riya', 'Nagpur');
COMMIT;
SET SERVEROUTPUT ON;

DELIMITER //

CREATE PROCEDURE merge_rollcall()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE v_roll INT;
    DECLARE v_name VARCHAR(50);
    DECLARE v_addr VARCHAR(50);
    DECLARE v_count INT;
    DECLARE cur CURSOR FOR SELECT roll_no, name, address FROM N_Roll_Call;
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;

    OPEN cur;

    read_loop: LOOP
        FETCH cur INTO v_roll, v_name, v_addr;
        IF done = 1 THEN
            LEAVE read_loop;
        END IF;

        SELECT COUNT(*) INTO v_count FROM O_Roll_Call WHERE roll_no = v_roll;

        IF v_count = 0 THEN
            INSERT INTO O_Roll_Call VALUES (v_roll, v_name, v_addr);
            SELECT CONCAT('Inserted Roll No: ', v_roll, ' - ', v_name) AS Message;
        ELSE
            SELECT CONCAT('Skipped Roll No: ', v_roll, ' (Already Exists)') AS Message;
        END IF;
    END LOOP;

    CLOSE cur;
END //

DELIMITER ;

SELECT * FROM O_Roll_Call;
