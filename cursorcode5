CREATE TABLE O_Roll_Call (
    roll_no NUMBER(5),
    name VARCHAR2(30),
    address VARCHAR2(50)
);

CREATE TABLE N_Roll_Call (
    roll_no NUMBER(5),
    name VARCHAR2(30),
    address VARCHAR2(50)
);


DECLARE
    -- Declare parameterized cursor
    CURSOR c_merge(p_roll N_Roll_Call.roll_no%TYPE) IS
        SELECT roll_no, name, address
        FROM N_Roll_Call
        WHERE roll_no = p_roll;

    v_roll   N_Roll_Call.roll_no%TYPE;
    v_name   N_Roll_Call.name%TYPE;
    v_addr   N_Roll_Call.address%TYPE;
    v_count  NUMBER;

BEGIN
    -- Loop through all records in N_Roll_Call
    FOR rec IN (SELECT * FROM N_Roll_Call) LOOP
        -- Check if roll number already exists in O_Roll_Call
        SELECT COUNT(*) INTO v_count
        FROM O_Roll_Call
        WHERE roll_no = rec.roll_no;

        -- If not exists, open parameterized cursor and insert
        IF v_count = 0 THEN
            OPEN c_merge(rec.roll_no);
            FETCH c_merge INTO v_roll, v_name, v_addr;

            INSERT INTO O_Roll_Call VALUES (v_roll, v_name, v_addr);

            CLOSE c_merge;
        ELSE
            DBMS_OUTPUT.PUT_LINE('Duplicate skipped: ' || rec.roll_no);
        END IF;
    END LOOP;

    DBMS_OUTPUT.PUT_LINE('Data merged successfully!');
END;
/
SELECT * FROM O_Roll_Call;
